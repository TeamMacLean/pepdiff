<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with pepdiff • pepdiff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with pepdiff">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pepdiff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_workflow.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Analysis Methods</h6></li>
    <li><a class="dropdown-item" href="../articles/glm_analysis.html">GLM Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/art_analysis.html">ART Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/pairwise_tests.html">Pairwise Tests</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Diagnostics</h6></li>
    <li><a class="dropdown-item" href="../articles/checking_fit.html">Checking Model Fit</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostic_plots.html">Diagnostic Plots</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Getting Started with pepdiff</h1>
            
      

      <div class="d-none name"><code>basic_workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-pepdiff">What is pepdiff?<a class="anchor" aria-label="anchor" href="#what-is-pepdiff"></a>
</h2>
<p>pepdiff performs differential abundance analysis for PRM (Parallel
Reaction Monitoring) proteomics data. Given peptide abundance
measurements across experimental conditions, it identifies which
peptides show significant changes between groups.</p>
<p>pepdiff is the analysis companion to <a href="https://github.com/macleand/peppwR" class="external-link">peppwR</a>, which handles
power analysis and experimental planning. The workflow is:</p>
<ul>
<li>
<strong>peppwR</strong>: “How many samples do I need?” (before the
experiment)</li>
<li>
<strong>pepdiff</strong>: “What’s differentially abundant?” (after
the experiment)</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"macleand/pepdiff"</span><span class="op">)</span></span></code></pre></div>
<p>Some features require Bioconductor packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For heatmaps</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"ComplexHeatmap"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For rank products test</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"RankProd"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pepdiff</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-example-data">Creating example data<a class="anchor" aria-label="anchor" href="#creating-example-data"></a>
</h2>
<p>We’ll generate synthetic data to demonstrate the workflow. This
represents a well-powered experiment: control vs treatment, with 10
biological replicates per group and 50 peptides measured. We use 3-fold
changes for differential peptides - large enough to detect reliably with
this sample size.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Experimental design</span></span>
<span><span class="co"># 10 reps and 3-fold changes give us good power to detect true effects</span></span>
<span><span class="va">n_peptides</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">n_reps</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate peptide names and gene IDs</span></span>
<span><span class="va">peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PEP_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%03d"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"GENE_"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">26</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 30% of peptides (15 out of 50) will be truly differentially abundant</span></span>
<span><span class="va">n_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_peptides</span> <span class="op">*</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">diff_peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">peptides</span>, <span class="va">n_diff</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Truly differential peptides:"</span>, <span class="va">n_diff</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Truly differential peptides: 15</span></span>
<span></span>
<span><span class="co"># Generate abundance data</span></span>
<span><span class="co"># Proteomics abundances are typically right-skewed (can't go below zero,</span></span>
<span><span class="co"># multiplicative processes). We use a Gamma distribution to reflect this.</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  peptide <span class="op">=</span> <span class="va">peptides</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">conditions</span>,</span>
<span>  bio_rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_reps</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    gene_id <span class="op">=</span> <span class="va">genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">peptides</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="co"># Base abundance varies by peptide (some peptides more abundant than others)</span></span>
<span>    base_abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_peptides</span>, shape <span class="op">=</span> <span class="fl">5</span>, rate <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">conditions</span><span class="op">)</span> <span class="op">*</span> <span class="va">n_reps</span><span class="op">)</span>,</span>
<span>    <span class="co"># Treatment effect for differential peptides (~3-fold change up or down)</span></span>
<span>    fc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">peptide</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">diff_peptides</span> <span class="op">&amp;</span> <span class="va">treatment</span> <span class="op">==</span> <span class="st">"trt"</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">n_diff</span> <span class="op">*</span> <span class="va">n_reps</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co"># Final value with biological noise</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">10</span>, rate <span class="op">=</span> <span class="fl">10</span> <span class="op">/</span> <span class="op">(</span><span class="va">base_abundance</span> <span class="op">*</span> <span class="va">fc</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">gene_id</span>, <span class="va">treatment</span>, <span class="va">bio_rep</span>, <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   peptide gene_id treatment bio_rep     value</span></span>
<span><span class="co">#&gt; 1 PEP_001  GENE_A      ctrl       1 11.375198</span></span>
<span><span class="co">#&gt; 2 PEP_002  GENE_B      ctrl       1  7.165007</span></span>
<span><span class="co">#&gt; 3 PEP_003  GENE_C      ctrl       1 10.177513</span></span>
<span><span class="co">#&gt; 4 PEP_004  GENE_D      ctrl       1 12.197742</span></span>
<span><span class="co">#&gt; 5 PEP_005  GENE_E      ctrl       1  9.041446</span></span>
<span><span class="co">#&gt; 6 PEP_006  GENE_F      ctrl       1  8.007804</span></span></code></pre></div>
<p>To use <code><a href="../reference/read_pepdiff.html">read_pepdiff()</a></code>, we need data in a CSV file. Let’s
write our simulated data to a temporary file:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">temp_file</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="importing-data">Importing data<a class="anchor" aria-label="anchor" href="#importing-data"></a>
</h2>
<p>The <code><a href="../reference/read_pepdiff.html">read_pepdiff()</a></code> function imports your data and
creates a structured object for analysis. You tell it which columns
contain what:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_pepdiff.html">read_pepdiff</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="va">temp_file</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"peptide"</span>,           <span class="co"># peptide identifiers</span></span>
<span>  gene <span class="op">=</span> <span class="st">"gene_id"</span>,         <span class="co"># gene identifiers</span></span>
<span>  value <span class="op">=</span> <span class="st">"value"</span>,          <span class="co"># abundance values</span></span>
<span>  factors <span class="op">=</span> <span class="st">"treatment"</span>,    <span class="co"># experimental factors</span></span>
<span>  replicate <span class="op">=</span> <span class="st">"bio_rep"</span>     <span class="co"># biological replicate IDs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">#&gt; pepdiff_data object</span></span>
<span><span class="co">#&gt; -------------------</span></span>
<span><span class="co">#&gt; Peptides: 50</span></span>
<span><span class="co">#&gt; Observations: 1000</span></span>
<span><span class="co">#&gt; Factors: treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Design:</span></span>
<span><span class="co">#&gt;   treatment=ctrl: 10 reps</span></span>
<span><span class="co">#&gt;   treatment=trt: 10 reps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No missing values</span></span></code></pre></div>
<p>The print output shows you what you’ve got: number of peptides,
experimental design, and data quality summary. The
<code>pepdiff_data</code> object contains:</p>
<ul>
<li>
<strong>data</strong>: Your measurements in long format</li>
<li>
<strong>factors</strong>: The experimental factors you
specified</li>
<li>
<strong>design</strong>: Summary of your experimental structure</li>
<li>
<strong>missingness</strong>: Per-peptide missing data
statistics</li>
</ul>
<p>For more detail:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; pepdiff_data Summary</span></span>
<span><span class="co">#&gt; ====================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data dimensions:</span></span>
<span><span class="co">#&gt;   - Total observations: 1000</span></span>
<span><span class="co">#&gt;   - Unique peptides: 50</span></span>
<span><span class="co">#&gt;   - Unique genes: 26</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Experimental factors:</span></span>
<span><span class="co">#&gt;   - treatment: ctrl, trt</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Design summary:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   treatment n_reps n_peptides n_observations</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ctrl          10         50            500</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> trt           10         50            500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness:</span></span>
<span><span class="co">#&gt;   - Peptides with missing values: 0 (0.0%)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-look-at-your-data">Quick look at your data<a class="anchor" aria-label="anchor" href="#quick-look-at-your-data"></a>
</h2>
<p>Before running any analysis, visualise your data. The
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method gives you a multi-panel diagnostic view:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_workflow_files/figure-html/plot-data-1.png" class="r-plt" alt="" width="672"></p>
<p>What to look for:</p>
<ul>
<li>
<strong>PCA</strong>: Replicates from the same condition should
cluster together. If samples scatter randomly, you may have a quality
issue.</li>
<li>
<strong>Distributions</strong>: Abundance distributions should be
similar across samples. Large shifts suggest normalisation
problems.</li>
<li>
<strong>Missingness</strong>: Random scatter is fine. Systematic
patterns (whole peptides missing in one condition) suggest MNAR (missing
not at random) - those peptides may not be analysable.</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-a-comparison">Running a comparison<a class="anchor" aria-label="anchor" href="#running-a-comparison"></a>
</h2>
<p>Now for the analysis. The <code><a href="../reference/compare.html">compare()</a></code> function tests for
differential abundance:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  compare <span class="op">=</span> <span class="st">"treatment"</span>,  <span class="co"># which factor to test</span></span>
<span>  ref <span class="op">=</span> <span class="st">"ctrl"</span>            <span class="co"># reference level (what to compare against)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; pepdiff_results object</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt; Method: glm</span></span>
<span><span class="co">#&gt; Peptides: 50</span></span>
<span><span class="co">#&gt; Comparisons: 1</span></span>
<span><span class="co">#&gt; Total tests: 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significant (FDR &lt; 0.05): 10 (20.0%)</span></span>
<span><span class="co">#&gt; Marked significant: 10</span></span></code></pre></div>
<p>The “Marked significant” count in the output is the number of
peptides <em>detected</em> as significant by the statistical test - not
the number we know to be truly differential. With 15 truly differential
peptides in our simulation, we hope to detect most of them while
minimising false positives.</p>
<p>By default, <code><a href="../reference/compare.html">compare()</a></code> uses a Gamma GLM (generalised
linear model). Why Gamma? Proteomics abundances are positive and
right-skewed - they arise from multiplicative processes and can’t go
below zero. The Gamma distribution models this naturally, and the log
link means coefficients are interpretable as fold changes.</p>
</div>
<div class="section level2">
<h2 id="understanding-results">Understanding results<a class="anchor" aria-label="anchor" href="#understanding-results"></a>
</h2>
<p>The results object contains everything you need:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The main results table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;   peptide gene_id comparison fold_change log2_fc estimate    se test     p_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PEP_001 GENE_A  trt - ctrl       0.695  -<span style="color: #BB0000;">0.524</span>  -<span style="color: #BB0000;">0.363</span>  0.196 glm      8.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PEP_002 GENE_B  trt - ctrl       0.905  -<span style="color: #BB0000;">0.143</span>  -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">3</span> 0.199 glm      6.24<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PEP_003 GENE_C  trt - ctrl       2.97    1.57    1.09   0.198 glm      3.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PEP_004 GENE_D  trt - ctrl       0.784  -<span style="color: #BB0000;">0.351</span>  -<span style="color: #BB0000;">0.243</span>  0.238 glm      3.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> PEP_005 GENE_E  trt - ctrl       3.12    1.64    1.14   0.127 glm      4.68<span style="color: #949494;">e</span><span style="color: #BB0000;">-8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> PEP_006 GENE_F  trt - ctrl       1.18    0.236   0.164  0.242 glm      5.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: fdr &lt;dbl&gt;, significant &lt;lgl&gt;</span></span></span></code></pre></div>
<p>Key columns:</p>
<ul>
<li>
<strong>fold_change</strong>: Ratio of treatment to control (&gt;1
means higher in treatment)</li>
<li>
<strong>log2_fc</strong>: Log2 of fold change (easier to interpret:
1 = doubled, -1 = halved)</li>
<li>
<strong>p_value</strong>: Statistical significance</li>
<li>
<strong>fdr</strong>: False discovery rate-adjusted p-value (use
this for significance calls)</li>
<li>
<strong>significant</strong>: TRUE if fdr &lt; alpha (default
0.05)</li>
</ul>
<div class="section level3">
<h3 id="getting-significant-hits">Getting significant hits<a class="anchor" aria-label="anchor" href="#getting-significant-hits"></a>
</h3>
<p>The <code><a href="../reference/significant.html">significant()</a></code> function extracts peptides that passed
the significance threshold:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig_peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/significant.html">significant</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="va">sig_peptides</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 11</span></span></span>
<span><span class="co">#&gt;    peptide gene_id comparison fold_change log2_fc estimate    se test    p_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PEP_003 GENE_C  trt - ctrl        2.97    1.57    1.09  0.198 glm     3.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PEP_005 GENE_E  trt - ctrl        3.12    1.64    1.14  0.127 glm     4.68<span style="color: #949494;">e</span><span style="color: #BB0000;">-8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PEP_009 GENE_I  trt - ctrl        2.80    1.48    1.03  0.254 glm     7.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PEP_014 GENE_N  trt - ctrl        3.97    1.99    1.38  0.228 glm     1.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PEP_015 GENE_O  trt - ctrl        3.33    1.74    1.20  0.407 glm     8.39<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PEP_025 GENE_Y  trt - ctrl        3.42    1.78    1.23  0.280 glm     3.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PEP_028 GENE_B  trt - ctrl        4.15    2.05    1.42  0.274 glm     6.26<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PEP_031 GENE_E  trt - ctrl        2.65    1.41    0.976 0.146 glm     2.78<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PEP_037 GENE_K  trt - ctrl        3.50    1.81    1.25  0.239 glm     5.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PEP_043 GENE_Q  trt - ctrl        3.31    1.73    1.20  0.344 glm     2.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: fdr &lt;dbl&gt;, significant &lt;lgl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualising-results">Visualising results<a class="anchor" aria-label="anchor" href="#visualising-results"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method for results shows you the key
diagnostic plots:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_workflow_files/figure-html/plot-results-1.png" class="r-plt" alt="" width="672"></p>
<p>What to look for:</p>
<ul>
<li>
<strong>Volcano plot</strong>: Points at the edges (large fold
change + low p-value) are your confident hits. Symmetric spread is
typical; all hits in one direction might indicate a global shift.</li>
<li>
<strong>P-value histogram</strong>: Under the null hypothesis (no
true signal), p-values are uniformly distributed. A spike near zero
indicates true positives. A U-shape suggests p-value inflation
(something’s wrong).</li>
<li>
<strong>Fold change distribution</strong>: Should be centered near
zero on log2 scale. A systematic shift suggests normalisation
issues.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="comparing-with-our-simulation">Comparing with our simulation<a class="anchor" aria-label="anchor" href="#comparing-with-our-simulation"></a>
</h2>
<p>Since we generated this data, we know which peptides were truly
differential. Let’s check how well we did:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># True positives: correctly identified as significant</span></span>
<span><span class="va">true_pos</span> <span class="op">&lt;-</span> <span class="va">sig_peptides</span><span class="op">$</span><span class="va">peptide</span><span class="op">[</span><span class="va">sig_peptides</span><span class="op">$</span><span class="va">peptide</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">diff_peptides</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># False positives: called significant but not truly differential</span></span>
<span><span class="va">false_pos</span> <span class="op">&lt;-</span> <span class="va">sig_peptides</span><span class="op">$</span><span class="va">peptide</span><span class="op">[</span><span class="op">!</span><span class="va">sig_peptides</span><span class="op">$</span><span class="va">peptide</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">diff_peptides</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># False negatives: truly differential but not called significant</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">diff_peptides</span><span class="op">[</span><span class="op">!</span><span class="va">diff_peptides</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sig_peptides</span><span class="op">$</span><span class="va">peptide</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True positives:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">true_pos</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; True positives: 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"False positives:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">false_pos</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; False positives: 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"False negatives:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">false_neg</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; False negatives: 5</span></span></code></pre></div>
<p>With 10 replicates and 3-fold effect sizes, we have good power to
detect most true positives. FDR control at 5% means that among peptides
called significant, we expect roughly 5% to be false positives - that’s
the trade-off you’re making. With smaller sample sizes or weaker
effects, you’d see more false negatives (missed true positives).</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>This vignette covered the basic workflow. For more detail, see:</p>
<ul>
<li>
<code><a href="../articles/pairwise_tests.html">vignette("pairwise_tests")</a></code>: Two-group comparisons with
different statistical tests</li>
<li>
<code><a href="../articles/diagnostic_plots.html">vignette("diagnostic_plots")</a></code>: Visual quality control
and interpretation</li>
<li>
<code><a href="../articles/glm_analysis.html">vignette("glm_analysis")</a></code>: Factorial designs with
multiple factors</li>
<li>
<code><a href="../articles/art_analysis.html">vignette("art_analysis")</a></code>: Non-parametric analysis when
GLM assumptions fail</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
