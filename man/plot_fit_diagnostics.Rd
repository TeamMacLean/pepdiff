% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics.R
\name{plot_fit_diagnostics}
\alias{plot_fit_diagnostics}
\title{Plot GLM fit diagnostics}
\usage{
plot_fit_diagnostics(
  results,
  n_sample = 6,
  deviance_threshold = NULL,
  full_qq = FALSE
)
}
\arguments{
\item{results}{A `pepdiff_results` object from `compare()` with `method = "glm"`}

\item{n_sample}{Number of peptides to show in sample residual plots (default 6)}

\item{deviance_threshold}{Optional threshold for flagging high-deviance peptides.
If NULL (default), uses the 95th percentile of deviance values.}

\item{full_qq}{Logical. If TRUE, refit all models to compute proper standardized
residuals for the QQ plot (slower but more accurate). If FALSE (default),
use an approximation based on stored deviance values.}
}
\value{
Invisibly returns a list with:
  \item{plot}{The diagnostic plot (ggplot/cowplot grid)}
  \item{flagged}{Tibble of peptides with potential fit issues}
  \item{summary}{List with summary statistics (n_flagged, median_deviance, etc.)}
}
\description{
Creates a multi-panel diagnostic plot to help assess whether GLM models
fit the data well. This is useful for deciding whether to use GLM or
switch to ART (Aligned Rank Transform).
}
\details{
The function generates a 4-panel diagnostic plot:

**Panel 1: Deviance Distribution** - Histogram showing the distribution of
residual deviance across all converged peptides. A long right tail suggests
some peptides fit poorly.

**Panel 2: Deviance vs Fold Change** - Scatter plot of deviance against
absolute log2 fold change. If high-deviance points cluster at extreme
fold changes, this may indicate outlier-driven "significant" results.

**Panel 3: Sample Residual Plots** - Residuals vs fitted values for a
sample of peptides (2 with highest deviance, 2 median, 2 lowest). Look
for random scatter around zero; patterns or funnels indicate poor fit.

**Panel 4: Pooled QQ Plot** - Quantile-quantile plot of pooled residuals.
Points should fall on the diagonal line. S-curves indicate heavy tails
(consider ART), systematic deviation suggests wrong distributional assumption.
}
\section{Interpretation}{


**Use GLM when:**
- Deviance distribution looks reasonable (few flagged peptides)
- No systematic patterns in residual plots
- QQ plot is reasonably linear

**Consider ART when:**
- Many peptides (>15%) have high deviance
- Residual plots show systematic curves or funnels
- QQ plot shows heavy tails (S-curve)
}

\examples{
\dontrun{
# Run GLM analysis
results <- compare(dat, compare = "treatment", ref = "ctrl", method = "glm")

# Check fit diagnostics
diag <- plot_fit_diagnostics(results)

# View flagged peptides
diag$flagged

# Get summary statistics
diag$summary
}

}
\seealso{
[compare()] for running the analysis, `vignette("checking_fit")`
  for detailed guidance on interpreting diagnostics
}
