<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Two-Group Comparisons with Pairwise Tests • pepdiff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two-Group Comparisons with Pairwise Tests">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pepdiff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_workflow.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Analysis Methods</h6></li>
    <li><a class="dropdown-item" href="../articles/glm_analysis.html">GLM Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/art_analysis.html">ART Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/pairwise_tests.html">Pairwise Tests</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Diagnostics</h6></li>
    <li><a class="dropdown-item" href="../articles/checking_fit.html">Checking Model Fit</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostic_plots.html">Diagnostic Plots</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Two-Group Comparisons with Pairwise Tests</h1>
            
      

      <div class="d-none name"><code>pairwise_tests.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pepdiff</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="when-to-use-pairwise-tests">When to use pairwise tests<a class="anchor" aria-label="anchor" href="#when-to-use-pairwise-tests"></a>
</h2>
<p>Pairwise tests are the simplest approach to differential abundance:
compare two groups directly, peptide by peptide. Use them when: - You
have a straightforward two-group comparison (control vs treatment) - You
don’t need to model interactions between multiple factors - You want
interpretable, assumption-light analysis</p>
<p>For experiments with multiple factors (treatment × timepoint ×
genotype), consider the GLM method instead - see
<code><a href="../articles/glm_analysis.html">vignette("glm_analysis")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>We’ll generate a well-powered dataset: control vs treatment, 10
replicates per group, 30 peptides. <strong>10 peptides are truly
differential</strong> (5 up-regulated 3-fold, 5 down-regulated 3-fold).
The remaining 20 have no true effect. With these settings, a good test
should detect most of the 10 true positives while calling few of the 20
true nulls as significant.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_peptides</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">n_reps</span> <span class="op">&lt;-</span> <span class="fl">10</span>  <span class="co"># Good power with 10 reps</span></span>
<span></span>
<span><span class="va">peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PEP_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%03d"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"GENE_"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">26</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 10 peptides with real effects (3-fold up or down)</span></span>
<span><span class="va">diff_peptides</span> <span class="op">&lt;-</span> <span class="va">peptides</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">effect_directions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  peptide <span class="op">=</span> <span class="va">peptides</span>,</span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt"</span><span class="op">)</span>,</span>
<span>  bio_rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_reps</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    gene_id <span class="op">=</span> <span class="va">genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">peptides</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_peptides</span>, shape <span class="op">=</span> <span class="fl">5</span>, rate <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">n_reps</span><span class="op">)</span>,</span>
<span>    effect <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">peptide</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">diff_peptides</span> <span class="op">&amp;</span> <span class="va">treatment</span> <span class="op">==</span> <span class="st">"trt"</span> <span class="op">~</span></span>
<span>        <span class="va">effect_directions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">diff_peptides</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">15</span>, rate <span class="op">=</span> <span class="fl">15</span> <span class="op">/</span> <span class="op">(</span><span class="va">base</span> <span class="op">*</span> <span class="va">effect</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">gene_id</span>, <span class="va">treatment</span>, <span class="va">bio_rep</span>, <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">temp_file</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_pepdiff.html">read_pepdiff</a></span><span class="op">(</span></span>
<span>  <span class="va">temp_file</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"peptide"</span>,</span>
<span>  gene <span class="op">=</span> <span class="st">"gene_id"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  factors <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  replicate <span class="op">=</span> <span class="st">"bio_rep"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">#&gt; pepdiff_data object</span></span>
<span><span class="co">#&gt; -------------------</span></span>
<span><span class="co">#&gt; Peptides: 30</span></span>
<span><span class="co">#&gt; Observations: 600</span></span>
<span><span class="co">#&gt; Factors: treatment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Design:</span></span>
<span><span class="co">#&gt;   treatment=ctrl: 10 reps</span></span>
<span><span class="co">#&gt;   treatment=trt: 10 reps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No missing values</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-four-pairwise-tests">The four pairwise tests<a class="anchor" aria-label="anchor" href="#the-four-pairwise-tests"></a>
</h2>
<p>pepdiff offers four pairwise tests, each with different properties.
Let’s run all four on the same data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_wilcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">dat</span>, compare <span class="op">=</span> <span class="st">"treatment"</span>, ref <span class="op">=</span> <span class="st">"ctrl"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"pairwise"</span>, test <span class="op">=</span> <span class="st">"wilcoxon"</span><span class="op">)</span></span>
<span><span class="va">res_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">dat</span>, compare <span class="op">=</span> <span class="st">"treatment"</span>, ref <span class="op">=</span> <span class="st">"ctrl"</span>,</span>
<span>                     method <span class="op">=</span> <span class="st">"pairwise"</span>, test <span class="op">=</span> <span class="st">"bootstrap_t"</span><span class="op">)</span></span>
<span><span class="va">res_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">dat</span>, compare <span class="op">=</span> <span class="st">"treatment"</span>, ref <span class="op">=</span> <span class="st">"ctrl"</span>,</span>
<span>                      method <span class="op">=</span> <span class="st">"pairwise"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span><span class="op">)</span></span>
<span><span class="va">res_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">dat</span>, compare <span class="op">=</span> <span class="st">"treatment"</span>, ref <span class="op">=</span> <span class="st">"ctrl"</span>,</span>
<span>                   method <span class="op">=</span> <span class="st">"pairwise"</span>, test <span class="op">=</span> <span class="st">"rankprod"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="wilcoxon-rank-sum-test">Wilcoxon rank-sum test<a class="anchor" aria-label="anchor" href="#wilcoxon-rank-sum-test"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_wilcox</span></span>
<span><span class="co">#&gt; pepdiff_results object</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt; Method: pairwise</span></span>
<span><span class="co">#&gt; Peptides: 30</span></span>
<span><span class="co">#&gt; Comparisons: 1</span></span>
<span><span class="co">#&gt; Total tests: 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significant (FDR &lt; 0.05): 10 (33.3%)</span></span>
<span><span class="co">#&gt; Marked significant: 10</span></span></code></pre></div>
<p>The “Marked significant” count shows how many peptides the test
<em>detected</em> - ideally close to our 10 truly differential peptides,
with few false positives from the 20 true nulls.</p>
<p>The Wilcoxon test compares <strong>ranks</strong>, not raw values.
Each observation gets a rank (1st smallest, 2nd smallest, etc.), then
the test asks: are ranks systematically higher in one group?</p>
<p><strong>Why ranks?</strong> Outliers can only affect your rank by 1
position, no matter how extreme. If one sample has a value 1000× higher
than the rest, it just gets the top rank - it can’t dominate the
analysis. This makes Wilcoxon robust to non-normality and outliers.</p>
<p><strong>Trade-off:</strong> By converting to ranks, you lose
magnitude information. A 10-fold difference and a 2-fold difference
might give similar results if the ranks are similar.</p>
<p><strong>When to use:</strong> Default choice for small samples (3-4
replicates), non-normal data, or when you suspect outliers.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-t-test">Bootstrap t-test<a class="anchor" aria-label="anchor" href="#bootstrap-t-test"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_boot</span></span>
<span><span class="co">#&gt; pepdiff_results object</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt; Method: pairwise</span></span>
<span><span class="co">#&gt; Peptides: 30</span></span>
<span><span class="co">#&gt; Comparisons: 1</span></span>
<span><span class="co">#&gt; Total tests: 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significant (FDR &lt; 0.05): 10 (33.3%)</span></span>
<span><span class="co">#&gt; Marked significant: 10</span></span></code></pre></div>
<p>The bootstrap t-test doesn’t assume your data follows a normal
distribution. Instead, it builds a null distribution by resampling your
actual data.</p>
<p><strong>How it works:</strong> 1. Pool all observations from both
groups 2. Randomly split them into fake “control” and “treatment” groups
3. Calculate the t-statistic for this fake split 4. Repeat thousands of
times 5. See where your real t-statistic falls in this distribution</p>
<p>This way, the null distribution comes from your data’s actual shape,
not a theoretical normal distribution.</p>
<p><strong>When to use:</strong> When you have 4+ replicates per group
and roughly symmetric data, but aren’t confident about normality.</p>
</div>
<div class="section level3">
<h3 id="bayes-factor-t-test">Bayes factor t-test<a class="anchor" aria-label="anchor" href="#bayes-factor-t-test"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_bayes</span></span>
<span><span class="co">#&gt; pepdiff_results object</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt; Method: pairwise</span></span>
<span><span class="co">#&gt; Peptides: 30</span></span>
<span><span class="co">#&gt; Comparisons: 1</span></span>
<span><span class="co">#&gt; Total tests: 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; BF threshold: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Evidence breakdown:</span></span>
<span><span class="co">#&gt;   strong_null: 0</span></span>
<span><span class="co">#&gt;   moderate_null: 0</span></span>
<span><span class="co">#&gt;   inconclusive: 20</span></span>
<span><span class="co">#&gt;   moderate_alt: 0</span></span>
<span><span class="co">#&gt;   strong_alt: 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significant (BF &gt; 3): 10 (33.3%)</span></span></code></pre></div>
<p>Notice the output is different from the other tests. Instead of
“Significant (FDR &lt; 0.05)”, you see an <strong>evidence
breakdown</strong> and “Significant (BF &gt; 3)”. This reflects a
fundamental difference in how Bayes factors work.</p>
<p><strong>Why Bayes factors are different from p-values:</strong></p>
<p>P-values and Bayes factors answer different questions:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Question</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>P-value</td>
<td>“If there’s no effect, how surprising is this data?”</td>
</tr>
<tr class="even">
<td>Bayes factor</td>
<td>“How much more likely is the data under effect vs no effect?”</td>
</tr>
</tbody>
</table>
<p>Because they’re fundamentally different, pepdiff handles
<code>bayes_t</code> results separately:</p>
<ul>
<li>
<code>p_value</code> and <code>fdr</code> columns are
<code>NA</code> (FDR correction doesn’t apply to BF)</li>
<li>
<code>bf</code> column contains the raw Bayes factor (BF10)</li>
<li>
<code>evidence</code> column categorizes the strength of
evidence</li>
<li>
<code>significant</code> uses <code>bf &gt; bf_threshold</code>
(default 3)</li>
</ul>
<p><strong>Interpreting BF:</strong></p>
<table class="table">
<thead><tr class="header">
<th>BF Range</th>
<th>Evidence</th>
<th>Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&lt; 0.1</td>
<td>Strong null</td>
<td>Strong evidence for <em>no</em> effect</td>
</tr>
<tr class="even">
<td>0.1 - 0.33</td>
<td>Moderate null</td>
<td>Moderate evidence for no effect</td>
</tr>
<tr class="odd">
<td>0.33 - 3</td>
<td>Inconclusive</td>
<td>Data don’t distinguish hypotheses</td>
</tr>
<tr class="even">
<td>3 - 10</td>
<td>Moderate alt</td>
<td>Moderate evidence for effect</td>
</tr>
<tr class="odd">
<td>&gt; 10</td>
<td>Strong alt</td>
<td>Strong evidence for effect</td>
</tr>
</tbody>
</table>
<p><strong>The key advantage:</strong> BF can provide evidence
<em>for</em> the null hypothesis, not just fail to reject it. A BF of
0.1 says “the data are 10× more likely if there’s no effect” - something
p-values can never tell you.</p>
<p><strong>When to use:</strong> When you want to quantify evidence
strength, not just reject/don’t reject. Particularly useful when you
want to conclude “no effect” rather than just “failed to detect
effect”.</p>
<p>You can adjust the threshold for significance:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Require strong evidence (BF &gt; 10)</span></span>
<span><span class="va">res_bayes_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">dat</span>, compare <span class="op">=</span> <span class="st">"treatment"</span>, ref <span class="op">=</span> <span class="st">"ctrl"</span>,</span>
<span>                             method <span class="op">=</span> <span class="st">"pairwise"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>,</span>
<span>                             bf_threshold <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rank-products">Rank products<a class="anchor" aria-label="anchor" href="#rank-products"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_rp</span></span>
<span><span class="co">#&gt; pepdiff_results object</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt; Method: pairwise</span></span>
<span><span class="co">#&gt; Peptides: 30</span></span>
<span><span class="co">#&gt; Comparisons: 1</span></span>
<span><span class="co">#&gt; Total tests: 30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significant (FDR &lt; 0.05): 10 (33.3%)</span></span>
<span><span class="co">#&gt; Marked significant: 10</span></span></code></pre></div>
<p>Rank products were designed specifically for high-throughput
experiments. For each peptide, it ranks the fold changes across
replicates, then multiplies ranks together.</p>
<p><strong>The intuition:</strong> If a peptide is consistently
up-regulated, it will have high ranks in every replicate, giving a high
product. If it’s only up in some replicates, the low ranks will drag the
product down.</p>
<p><strong>When to use:</strong> When you expect effects to be
consistent in direction across replicates. The method is particularly
sensitive to consistent small effects.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-rank-products-differs-from-other-tests">How Rank Products differs from other tests<a class="anchor" aria-label="anchor" href="#how-rank-products-differs-from-other-tests"></a>
</h2>
<p>The other pairwise tests (wilcoxon, bootstrap_t, bayes_t) analyze
each peptide independently - they ask “is this peptide different between
groups?”</p>
<p>Rank Products works differently. It ranks <strong>all
peptides</strong> by their fold change, then asks “does this peptide
consistently rank near the top/bottom?” A peptide with FC=2 might be
significant if most peptides have FC≈1, but not significant if many
peptides have FC&gt;2.</p>
<p>This means:</p>
<ul>
<li>Results depend on what other peptides are in your dataset</li>
<li>The method excels at finding consistent small effects across
replicates</li>
<li>It’s less appropriate when you only have a few peptides or when
effects vary in direction</li>
</ul>
<p>Rank Products requires the RankProd Bioconductor package, which is
installed automatically with pepdiff’s suggested dependencies.</p>
</div>
<div class="section level2">
<h2 id="comparing-results-across-tests">Comparing results across tests<a class="anchor" aria-label="anchor" href="#comparing-results-across-tests"></a>
</h2>
<p>With 10 truly differential peptides, we want tests that detect most
of them (high sensitivity) while not calling too many of the 20 true
nulls significant (low false positive rate). Let’s see how the tests
compare:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  peptide <span class="op">=</span> <span class="va">res_wilcox</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">peptide</span>,</span>
<span>  truly_diff <span class="op">=</span> <span class="va">peptide</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">diff_peptides</span>,</span>
<span>  wilcoxon <span class="op">=</span> <span class="va">res_wilcox</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">significant</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="va">res_boot</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">significant</span>,</span>
<span>  bayes <span class="op">=</span> <span class="va">res_bayes</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">significant</span>,</span>
<span>  rankprod <span class="op">=</span> <span class="va">res_rp</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">significant</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many significant calls per test?</span></span>
<span><span class="va">comparison</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">wilcoxon</span><span class="op">:</span><span class="va">rankprod</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   wilcoxon bootstrap bayes rankprod</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       10        10    10       10</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Agreement on truly differential peptides</span></span>
<span><span class="va">comparison</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">truly_diff</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    detected_by_all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wilcoxon</span> <span class="op">&amp;</span> <span class="va">bootstrap</span> <span class="op">&amp;</span> <span class="va">bayes</span> <span class="op">&amp;</span> <span class="va">rankprod</span><span class="op">)</span>,</span>
<span>    detected_by_any <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wilcoxon</span> <span class="op">|</span> <span class="va">bootstrap</span> <span class="op">|</span> <span class="va">bayes</span> <span class="op">|</span> <span class="va">rankprod</span><span class="op">)</span>,</span>
<span>    missed_by_all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">wilcoxon</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">bootstrap</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">bayes</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">rankprod</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   detected_by_all detected_by_any missed_by_all</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              10              10             0</span></span></code></pre></div>
<p>The tests often agree on strong effects but may differ on borderline
cases. When they disagree, it’s worth investigating that peptide more
closely.</p>
</div>
<div class="section level2">
<h2 id="fdr-correction-p-value-tests-only">FDR correction (p-value tests only)<a class="anchor" aria-label="anchor" href="#fdr-correction-p-value-tests-only"></a>
</h2>
<p>For wilcoxon, bootstrap_t, and rankprod, pepdiff reports both raw
p-values and FDR-adjusted values. <strong>Always use the
<code>fdr</code> column for significance decisions.</strong></p>
<p><strong>What is FDR?</strong> If you test 30 peptides at α = 0.05,
you expect 1-2 false positives by chance alone. FDR (false discovery
rate) correction accounts for this multiple testing. At 5% FDR, among
all peptides you call significant, you expect about 5% to be false
positives.</p>
<p>The Benjamini-Hochberg method is used by default. It’s less
conservative than Bonferroni (you’ll miss fewer true positives) but
still controls false discoveries.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Raw p-values vs FDR-adjusted</span></span>
<span><span class="va">res_wilcox</span><span class="op">$</span><span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">peptide</span>, <span class="va">p_value</span>, <span class="va">fdr</span>, <span class="va">significant</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">p_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;    peptide  p_value     fdr significant</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PEP_005 0.000<span style="text-decoration: underline;">206</span> 0.001<span style="text-decoration: underline;">95</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PEP_010 0.000<span style="text-decoration: underline;">206</span> 0.001<span style="text-decoration: underline;">95</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PEP_001 0.000<span style="text-decoration: underline;">325</span> 0.001<span style="text-decoration: underline;">95</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PEP_002 0.000<span style="text-decoration: underline;">325</span> 0.001<span style="text-decoration: underline;">95</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PEP_004 0.000<span style="text-decoration: underline;">325</span> 0.001<span style="text-decoration: underline;">95</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PEP_008 0.000<span style="text-decoration: underline;">725</span> 0.003<span style="text-decoration: underline;">63</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PEP_007 0.001<span style="text-decoration: underline;">05</span>  0.004<span style="text-decoration: underline;">50</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PEP_006 0.002<span style="text-decoration: underline;">09</span>  0.006<span style="text-decoration: underline;">96</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PEP_009 0.002<span style="text-decoration: underline;">09</span>  0.006<span style="text-decoration: underline;">96</span> TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PEP_003 0.005<span style="text-decoration: underline;">20</span>  0.015<span style="text-decoration: underline;">6</span>  TRUE</span></span></code></pre></div>
<p>Notice how the FDR values are always &gt;= the p-values. The
adjustment is stronger for peptides ranking lower in significance.</p>
<p><strong>Note:</strong> <code>bayes_t</code> does not use FDR
correction. Bayes factors already account for prior probabilities, and
traditional multiple testing corrections don’t apply. Instead, use the
<code>bf</code> column directly with an appropriate threshold (default:
BF &gt; 3).</p>
</div>
<div class="section level2">
<h2 id="visualising-results">Visualising results<a class="anchor" aria-label="anchor" href="#visualising-results"></a>
</h2>
<p>For p-value based tests, the multi-panel plot shows a volcano plot,
p-value histogram, and fold change distribution:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_wilcox</span><span class="op">)</span></span></code></pre></div>
<p><img src="pairwise_tests_files/figure-html/plot-results-1.png" class="r-plt" alt="" width="672"></p>
<p><strong>P-value histogram interpretation:</strong></p>
<ul>
<li>
<strong>Uniform distribution</strong>: No signal. All peptides
behave as expected under null.</li>
<li>
<strong>Spike near 0 + uniform elsewhere</strong>: True positives
exist. The spike represents peptides with real effects.</li>
<li>
<strong>U-shape</strong> (spikes at both 0 and 1): Something’s wrong
- possibly violated assumptions or technical artifacts.</li>
</ul>
<div class="section level3">
<h3 id="bayes-factor-plots">Bayes factor plots<a class="anchor" aria-label="anchor" href="#bayes-factor-plots"></a>
</h3>
<p>For <code>bayes_t</code> results, pepdiff shows BF-specific
visualizations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_bayes</span><span class="op">)</span></span></code></pre></div>
<p><img src="pairwise_tests_files/figure-html/plot-bayes-1.png" class="r-plt" alt="" width="672"></p>
<p><strong>BF volcano plot:</strong> The y-axis shows log10(BF) instead
of -log10(p). Points above 0 favor the alternative (effect exists);
points below 0 favor the null (no effect). Reference lines at BF = 3 and
BF = 0.33 mark conventional thresholds.</p>
<p><strong>BF distribution:</strong> Shows the distribution of log10(BF)
values. A good experiment with real effects will show a right tail (high
BF for true positives). Unlike p-value histograms, BF distributions can
pile up on <em>either</em> side - left tail means evidence for null,
right tail means evidence for effect.</p>
</div>
</div>
<div class="section level2">
<h2 id="when-pairwise-isnt-enough">When pairwise isn’t enough<a class="anchor" aria-label="anchor" href="#when-pairwise-isnt-enough"></a>
</h2>
<p>Pairwise tests treat each comparison independently. This becomes
limiting when:</p>
<ul>
<li>
<strong>Multiple factors</strong>: Treatment effect at timepoint 1
vs timepoint 2? Pairwise can’t model this directly.</li>
<li>
<strong>Interactions</strong>: Does treatment work differently in
wildtype vs knockout? You need a model that includes both factors.</li>
<li>
<strong>Efficiency</strong>: With factorial designs, GLM uses all
your data to estimate each effect, giving more power.</li>
</ul>
<p>For these cases, see <code><a href="../articles/glm_analysis.html">vignette("glm_analysis")</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
